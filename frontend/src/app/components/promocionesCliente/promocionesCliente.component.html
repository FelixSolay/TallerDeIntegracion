<div class="promos-container">
  <div class="promos-header">
    <h1>Promociones especiales</h1>
    <p class="subtitle">Aprovech√° los descuentos vigentes y llev√° tus productos favoritos al mejor precio.</p>
  </div>

  <div class="promos-controls" *ngIf="!cargando && !error && promociones.length > 0">
    <label for="orden-promos">Ordenar por</label>
    <select 
      id="orden-promos"
      class="filtro-select"
      [(ngModel)]="ordenSeleccionado"
      (change)="onOrdenChange()">
      <option value="relevancia">M√°s relevantes (descuentos)</option>
      <option value="nombre-asc">Nombre A ‚Üí Z</option>
      <option value="nombre-desc">Nombre Z ‚Üí A</option>
      <option value="precio-asc">Precio menor a mayor</option>
      <option value="precio-desc">Precio mayor a menor</option>
    </select>
    <span class="orden-info">Orden actual: {{
      ordenSeleccionado === 'relevancia' ? 'M√°s relevantes' :
      ordenSeleccionado === 'nombre-asc' ? 'Nombre A ‚Üí Z' :
      ordenSeleccionado === 'nombre-desc' ? 'Nombre Z ‚Üí A' :
      ordenSeleccionado === 'precio-asc' ? 'Precio menor a mayor' :
      'Precio mayor a menor'
    }}</span>
  </div>

  <div *ngIf="cargando" class="estado estado-loading">
    <p>Cargando promociones...</p>
  </div>

  <div *ngIf="!cargando && error" class="estado estado-error">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!cargando && !error && promociones.length === 0" class="estado estado-empty">
    <p>No hay promociones activas en este momento. Volv√© pronto para descubrir nuevas ofertas.</p>
  </div>

  <div *ngIf="!cargando && !error && promocionesOrdenadas.length > 0" class="productos-grid">
    <div class="producto-card" *ngFor="let item of promocionesOrdenadas">
      <div class="producto-imagen-container">
        <img
          *ngIf="item.producto.imagen"
          [src]="item.producto.imagen"
          [alt]="item.producto.nombre"
          class="producto-imagen"
        />
        <div *ngIf="!item.producto.imagen" class="producto-sin-imagen">
          <span>üéâ</span>
        </div>
        <div
          *ngIf="item.producto.stock !== undefined && item.producto.stock <= 5"
          class="badge-stock-bajo"
        >
          {{ item.producto.stock === 0 ? 'Sin stock' : '√öltimas unidades' }}
        </div>
      </div>

      <div class="producto-info">
        <h3 class="producto-nombre">{{ item.producto.nombre }}</h3>
        <p *ngIf="item.producto.descripcion" class="producto-descripcion">
          {{ item.producto.descripcion }}
        </p>
        <div class="producto-precio-container con-promocion">
          <div class="precio-wrapper">
            <span class="producto-precio precio-promocional">{{ formatearPrecio(item.precioVigente) }}</span>
            <span class="producto-precio-original">{{ formatearPrecio(obtenerPrecioOriginal(item)) }}</span>
          </div>
          <span class="producto-badge-promocion">{{ formatearEtiquetaPromocion(item) }}</span>
          <span *ngIf="item.producto.stock !== undefined" class="producto-stock">
            Stock: {{ item.producto.stock }}
          </span>
        </div>
      </div>

      <div class="producto-acciones">
        <div class="cantidad-selector">
          <button class="btn-cantidad" (click)="decrementarCantidad(item)" [disabled]="item.cantidad <= 1">‚àí</button>
          <span class="cantidad-display">{{ item.cantidad }}</span>
          <button
            class="btn-cantidad"
            (click)="incrementarCantidad(item)"
            [disabled]="item.producto.stock !== undefined && item.cantidad >= item.producto.stock"
          >
            +
          </button>
        </div>
        <div class="botones-compra">
          <button
            class="btn-agregar-carrito"
            (click)="agregarAlCarrito(item)"
            [disabled]="item.producto.stock === 0"
          >
            üõí Llevar promoci√≥n
          </button>
          <button
            type="button"
            class="btn-favorito"
            [class.active]="item.esFavorito"
            [attr.aria-pressed]="item.esFavorito"
            [disabled]="!item.producto._id"
            (click)="toggleFavorito(item)"
            [title]="item.esFavorito ? 'Quitar de favoritos' : 'Agregar a favoritos'"
          >
            <span>{{ item.esFavorito ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
